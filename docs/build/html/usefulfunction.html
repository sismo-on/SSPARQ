

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Useful functions &mdash; RSBR_15_years 0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=92fd9be5" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=2709fde1"></script>
      <script src="_static/doctools.js?v=9a2dae69"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
      <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
      <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Requirements" href="requirements.html" />
    <link rel="prev" title="Methodology" href="method.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            RSBR_15_years
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="whatis.html">Project Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="fetching.html">Fetching Seismic Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="method.html">Methodology</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Useful functions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#find-sensor-misorientation">Find sensor misorientation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#applying-the-algorithm-of-braunmiller-pornsopin">Applying the algorithm of Braunmiller &amp; Pornsopin</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="requirements.html">Requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="todolist.html">ToDo list</a></li>
<li class="toctree-l1"><a class="reference internal" href="references.html">References</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">RSBR_15_years</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Useful functions</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/usefulfunction.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section class="tex2jax_ignore mathjax_ignore" id="useful-functions">
<h1>Useful functions<a class="headerlink" href="#useful-functions" title="Link to this heading"></a></h1>
<section id="find-sensor-misorientation">
<h2>Find sensor misorientation<a class="headerlink" href="#find-sensor-misorientation" title="Link to this heading"></a></h2>
<dl class="py function">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">find_orientation(baz,</span> <span class="pre">SS,</span> <span class="pre">CCRZ,</span> <span class="pre">ETER,</span> <span class="pre">EREZ):</span></span></dt>
<dd><p>This function calculates the best back azimuth (φ) and sensor misorientation (θ) based on the
given quality criteria:</p>
<ul class="simple">
<li><p>Transverse signal strength (SS),</p></li>
<li><p>Similarity of radial and vertical components (CCRZ),</p></li>
<li><p>Transverse-to-radial energy ratio (ETER), and</p></li>
<li><p>Radial-to-vertical energy ratio (EREZ).</p></li>
</ul>
<p>The cost function combines these criteria in such a way that minimazing the cost function helps to
find the optimal back azimuth and corresponding orientation. The function outputs the best back azimuth, orientation, and the values of the quality criteria at the best azimuth index.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>baz</strong> (<em>float</em>) – Initial back-azimuth from taup model (degrees)</p></li>
<li><p><strong>SS</strong> (<em>numpy.ndarray</em>) – Transverse signal strength array (0 to 1 normalized)</p></li>
<li><p><strong>CCRZ</strong> (<em>numpy.ndarray</em>) – Vertical-radial similarity array (-1 to 1 normalized)</p></li>
<li><p><strong>ETER</strong> (<em>numpy.ndarray</em>) – Transverse-to-radial energy ratios</p></li>
<li><p><strong>EREZ</strong> (<em>numpy.ndarray</em>) – Radial-to-vertical energy ratios</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>φ, θ, SS_best, SZR_best, ETERR_best, EREZ_best</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>tuple of (float, float, float, float, float, float)</p>
</dd>
</dl>
</dd></dl>

<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>For optimal results:</p>
<ul class="simple">
<li><p>Use 0.1° azimuth search increments</p></li>
<li><p>Normalize before optimization</p></li>
</ul>
</div>
<div class="admonition-formula admonition">
<p class="admonition-title">Formula</p>
<p>The optimization minimazes:</p>
<div class="math notranslate nohighlight">
\[
\mathcal{Cost}(\phi) = SS_{T} - CC_{RZ}
\]</div>
<p>Where:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(SS_{T}\)</span> = Normalized transverse component energy</p></li>
<li><p><span class="math notranslate nohighlight">\(CC_{RZ}\)</span> = Radial-to-vertical Pearson correlation</p></li>
</ul>
</div>
</section>
<hr class="docutils" />
<section id="applying-the-algorithm-of-braunmiller-pornsopin">
<h2>Applying the algorithm of Braunmiller &amp; Pornsopin<a class="headerlink" href="#applying-the-algorithm-of-braunmiller-pornsopin" title="Link to this heading"></a></h2>
<dl class="py function">
<dt class="sig sig-object py">
<span class="sig-name descname"><span class="pre">Braunmiller_Pornsopin_algorithm(tr1,</span> <span class="pre">tr2,</span> <span class="pre">trZ,</span> <span class="pre">noise,</span> <span class="pre">baz,</span> <span class="pre">time_ins,</span> <span class="pre">CCVR_MIN=0.45,</span> <span class="pre">SNR_MIN=10,</span> <span class="pre">TRR_MIN=0.45,</span> <span class="pre">RVR_MIN=-1):</span></span></dt>
<dd><p>Implements the P-wave particle motion analysis for:</p>
<ul class="simple">
<li><p>Back-azimuth estimation</p></li>
<li><p>Sensor misorientation detection</p></li>
<li><p>Time instability</p></li>
<li><p>Instrument gain calculation</p></li>
<li><p>Data quality assessment</p></li>
</ul>
<p>Applies quality criteria with configurable thresholds.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>tr1</strong> (<em>numpy.ndarray</em>) – First horizontal component (typically North)</p></li>
<li><p><strong>tr2</strong> (<em>numpy.ndarray</em>) – Second horizontal component (typically East)</p></li>
<li><p><strong>trZ</strong> (<em>numpy.ndarray</em>) – Vertical component</p></li>
<li><p><strong>noise</strong> (<em>numpy.ndarray</em>) – Noise window for SNR calculation</p></li>
<li><p><strong>baz</strong> (<em>float</em>) – Theoretical back-azimuth (degrees)</p></li>
<li><p><strong>time_ins</strong> (<em>float</em>) – Observed-predicted time difference (seconds)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Dictionary containing 15 result metrics</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>dict</p>
</dd>
</dl>
</dd></dl>

<div class="admonition important">
<p class="admonition-title">Important</p>
<p><strong>Quality Criteria Thresholds</strong>:</p>
<ol class="arabic simple">
<li><p>SNR ≥ 10 dB</p></li>
<li><p>Vertical-radial correlation ≥ 0.5</p></li>
<li><p>Transverse/radial energy ratio ≤ 0.2</p></li>
<li><p>-90 sec &lt; Time residual |Δt| &lt; 90 sec</p></li>
<li><p>Radial/vertical energy ratio ≤ 2</p></li>
</ol>
</div>
<div class="admonition-component-rotation-implemented-as admonition">
<p class="admonition-title">Component rotation implemented as:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{pmatrix}
R \\ 
T 
\end{pmatrix} = 
\begin{pmatrix}
\cos\phi &amp; \sin\phi \\ 
-\sin\phi &amp; \cos\phi  
\end{pmatrix}
\begin{pmatrix}
H_{N} \\ 
H_{E} 
\end{pmatrix}
\end{split}\]</div>
<p>Where energy ratios are calculated as:</p>
<div class="math notranslate nohighlight">
\[
ETER = \frac{\int T^2(t)dt}{\int R^2(t)dt}
\]</div>
<div class="math notranslate nohighlight">
\[
EREZ = \frac{\int R^2(t)dt}{\int Z^2(t)dt}
\]</div>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<ul class="simple">
<li><p>Braunmiller, J.,J. Nabelek, and A. Ghods (2020). Sensor Orientation of Iranian Broadband Seismic Stations from P-Wave Particle Motion, Seismol. Res. Lett. 91, 1660–1671, doi: 10.1785/0220200019.</p></li>
<li><p>Pornsopin, P., Pananont, P., Furlong, K.P. et al. Sensor orientation of the TMD seismic network (Thailand) from P-wave particle motions. Geosci. Lett. 10, 24 (2023). https://doi.org/10.1186/s40562-023-00278-7.</p></li>
<li><p>Zhu, G., H. Yang,J. Lin, and Q. You (2020). Determining the Orientation of Ocean-Bottom Seismometers on the Seafloor and Correcting for Polarity Flipping via Polarization Analysis and Waveform Modeling, Seismol. Res. Lett. XX, 1–12, doi: 10.1785/0220190239.</p></li>
</ul>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="method.html" class="btn btn-neutral float-left" title="Methodology" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="requirements.html" class="btn btn-neutral float-right" title="Requirements" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Diogo L.O.C..</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>